{% extends 'cs/base.html' %}
{% load static %}

{% block title %}{{ page_title }}{% endblock %}

{% block extra_css %}
<style>
    @keyframes fadeInUp {
        from {
            opacity: 0;
            transform: translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes fadeInRow {
        from {
            opacity: 0;
            transform: translateX(-10px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    .fade-in-up {
        animation: fadeInUp 0.6s ease-out;
    }
    
    .gradient-text {
        background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }
    
    .glass-card {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(20px) saturate(180%);
        -webkit-backdrop-filter: blur(20px) saturate(180%);
        border: 1px solid rgba(255, 255, 255, 0.3);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }
    
    .glass-card:hover {
        background: rgba(255, 255, 255, 0.9);
        box-shadow: 0 12px 48px rgba(134, 239, 172, 0.2);
    }
    
    /* Member Card Styles - Modern Card Layout */
    .member-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(229, 231, 235, 0.5);
        border-radius: 1rem;
        padding: 1.25rem 1.5rem;
        margin-bottom: 1rem;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
        cursor: pointer;
        animation: fadeInRow 0.4s ease-out;
    }
    
    .member-card::before {
        content: '';
        position: absolute;
        left: 0;
        top: 0;
        bottom: 0;
        width: 4px;
        background: linear-gradient(180deg, #22c55e, #86efac);
        transform: scaleY(0);
        transition: transform 0.3s ease;
        transform-origin: top;
    }
    
    .member-card:hover {
        transform: translateX(8px) translateY(-2px);
        box-shadow: 0 8px 24px rgba(134, 239, 172, 0.2), 0 0 0 1px rgba(134, 239, 172, 0.2);
        background: rgba(255, 255, 255, 1);
        border-color: rgba(134, 239, 172, 0.4);
    }
    
    .member-card:hover::before {
        transform: scaleY(1);
    }
    
    .member-card:active {
        transform: translateX(4px) translateY(0);
    }
    
    .member-card-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
    }
    
    .member-avatar {
        width: 3.5rem;
        height: 3.5rem;
        border-radius: 0.75rem;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 1.125rem;
        flex-shrink: 0;
        position: relative;
        transition: all 0.3s ease;
    }
    
    .member-card:hover .member-avatar {
        transform: scale(1.1) rotate(5deg);
    }
    
    .member-info {
        flex: 1;
        min-width: 0;
    }
    
    .member-name {
        font-size: 1rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.25rem;
        line-height: 1.4;
    }
    
    .member-id {
        font-size: 0.75rem;
        color: #6b7280;
        font-weight: 500;
        font-family: monospace;
    }
    
    .member-email {
        font-size: 0.75rem;
        color: #9ca3af;
        margin-top: 0.25rem;
    }
    
    .member-stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(100px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
        padding-top: 1rem;
        border-top: 1px solid rgba(229, 231, 235, 0.5);
    }
    
    .member-stat-item {
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .member-stat-label {
        font-size: 0.7rem;
        color: #9ca3af;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }
    
    .member-stat-value {
        font-size: 1.125rem;
        font-weight: 600;
        color: #1f2937;
    }
    
    .member-card-grid {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        padding: 1rem;
    }
    
    .member-status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-size: 0.75rem;
        font-weight: 500;
        margin-top: 0.5rem;
    }
    
    .status-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-size: 0.75rem;
        font-weight: 500;
    }
    
    .green-scrollbar::-webkit-scrollbar {
        height: 8px;
        width: 8px;
    }
    
    .green-scrollbar::-webkit-scrollbar-track {
        background: rgba(34, 197, 94, 0.1);
        border-radius: 4px;
    }
    
    .green-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(34, 197, 94, 0.3);
        border-radius: 4px;
        transition: background 0.2s ease;
    }
    
    .green-scrollbar::-webkit-scrollbar-thumb:hover {
        background: rgba(34, 197, 94, 0.5);
    }
    
    .green-scrollbar {
        scroll-behavior: smooth;
    }
    
    .avatar-circle {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.875rem;
        flex-shrink: 0;
    }
    
    .avatar-green {
        background: linear-gradient(135deg, rgba(34, 197, 94, 0.2) 0%, rgba(34, 197, 94, 0.1) 100%);
        color: #22c55e;
    }
    
    .avatar-red {
        background: linear-gradient(135deg, rgba(239, 68, 68, 0.2) 0%, rgba(239, 68, 68, 0.1) 100%);
        color: #ef4444;
    }
    
    @media (max-width: 768px) {
        .table-header th,
        table tbody td {
            padding: 0.75rem 1rem;
            font-size: 0.875rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<!-- Header -->
<div class="mb-8 fade-in-up" style="animation-delay: 0.1s;">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
        <div>
            <h1 class="text-3xl sm:text-4xl font-light tracking-tight mb-2 gradient-text">
                Informasi Member
            </h1>
            <p class="text-gray-600 font-light text-sm sm:text-base">
                Lihat informasi member dan perangkat RangBot (Read-only)
            </p>
        </div>
    </div>
</div>

<!-- Messages -->
{% if messages %}
<div class="mb-6 space-y-2 fade-in-up" style="animation-delay: 0.2s;">
    {% for message in messages %}
    <div class="px-4 py-3 rounded-xl glass-card text-sm font-light" 
         style="border-color: {% if message.tags == 'success' %}rgba(34, 197, 94, 0.4){% elif message.tags == 'error' %}rgba(239, 68, 68, 0.4){% else %}rgba(229, 231, 235, 0.6){% endif %}; color: {% if message.tags == 'success' %}#22c55e{% elif message.tags == 'error' %}#ef4444{% else %}#6b7280{% endif %};">
        <i class="fas {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'error' %}fa-exclamation-circle{% else %}fa-info-circle{% endif %} mr-2"></i>
        {{ message }}
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Search Filter -->
<div class="glass-card rounded-2xl border p-4 sm:p-6 mb-6 fade-in-up" style="border-color: rgba(134, 239, 172, 0.2); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); animation-delay: 0.2s;">
    <form method="get" class="flex flex-col sm:flex-row gap-4">
        <div class="flex-1">
            <label class="block text-sm font-light text-gray-700 mb-2">Cari Member</label>
            <input type="text" name="search" value="{{ search_query }}" placeholder="Member ID, nama, email, atau serial number..." 
                   class="w-full px-4 py-2.5 rounded-xl border font-light text-sm focus:outline-none focus:ring-2 focus:ring-green-500 transition-all"
                   style="border-color: rgba(229, 231, 235, 0.6);">
        </div>
        <div class="sm:w-48">
            <label class="block text-sm font-light text-gray-700 mb-2">Filter Member ID</label>
            <input type="text" name="member" value="{{ member_filter }}" placeholder="Member ID..." 
                   class="w-full px-4 py-2.5 rounded-xl border font-light text-sm focus:outline-none focus:ring-2 focus:ring-green-500 transition-all"
                   style="border-color: rgba(229, 231, 235, 0.6);">
        </div>
        <div class="flex items-end gap-2">
            <button type="submit" class="px-6 py-2.5 rounded-xl text-white font-medium text-sm transition-all"
                    style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); box-shadow: 0 4px 12px rgba(34, 197, 94, 0.3);">
                <i class="fas fa-search mr-2"></i>Cari
            </button>
            {% if search_query or member_filter %}
            <a href="{% url 'main:cs_members' %}" class="px-6 py-2.5 rounded-xl border font-medium text-sm text-gray-700 transition-all"
               style="border-color: rgba(229, 231, 235, 0.6);">
                Reset
            </a>
            {% endif %}
        </div>
    </form>
</div>

<!-- Members Cards -->
<div class="glass-card rounded-2xl border overflow-hidden fade-in-up" style="border-color: rgba(134, 239, 172, 0.2); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05); animation-delay: 0.3s;">
    {% if members_with_stats %}
    <div class="overflow-y-auto green-scrollbar" style="max-height: 70vh;">
        <div class="member-card-grid">
            {% for item in members_with_stats %}
            {% with member=item.member %}
            <div class="member-card" onclick="window.location.href='{% url 'main:cs_member_detail' member.member_id %}'">
                <div class="member-card-header">
                    <div class="member-avatar {% cycle 'avatar-green' 'avatar-red' %}">
                        {{ member.full_name|first|upper }}
                    </div>
                    <div class="member-info">
                        <div class="member-name">{{ member.full_name }}</div>
                        <div class="member-id">{{ member.member_id }}</div>
                        {% if member.email %}
                        <div class="member-email">
                            <i class="fas fa-envelope text-xs mr-1"></i>{{ member.email }}
                        </div>
                        {% endif %}
                        <div class="member-status-badge" style="{% if member.is_registered %}background: linear-gradient(135deg, rgba(34, 197, 94, 0.15) 0%, rgba(34, 197, 94, 0.1) 100%); color: #22c55e; border: 1px solid rgba(34, 197, 94, 0.3);{% else %}background: linear-gradient(135deg, rgba(239, 68, 68, 0.15) 0%, rgba(239, 68, 68, 0.1) 100%); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3);{% endif %}">
                            <i class="fas {% if member.is_registered %}fa-check-circle{% else %}fa-clock{% endif %}"></i>
                            <span>{% if member.is_registered %}Terdaftar{% else %}Belum Terdaftar{% endif %}</span>
                        </div>
                    </div>
                </div>
                <div class="member-stats">
                    <div class="member-stat-item">
                        <div class="member-stat-label">Total Device</div>
                        <div class="member-stat-value" style="color: #22c55e;">{{ item.total_devices }}</div>
                    </div>
                    <div class="member-stat-item">
                        <div class="member-stat-label">Professional</div>
                        <div class="member-stat-value" style="color: #9333ea;">{{ item.pro_count }}</div>
                    </div>
                    <div class="member-stat-item">
                        <div class="member-stat-label">Basic</div>
                        <div class="member-stat-value" style="color: #6366f1;">{{ item.basic_count }}</div>
                    </div>
                    {% if item.total_orders %}
                    <div class="member-stat-item">
                        <div class="member-stat-label">Total Orders</div>
                        <div class="member-stat-value" style="color: #f59e0b;">{{ item.total_orders }}</div>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endwith %}
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div class="text-center py-16">
        <div class="inline-flex items-center justify-center w-20 h-20 rounded-full mb-4" style="background: rgba(134, 239, 172, 0.1);">
            <i class="fas fa-users text-4xl text-gray-300"></i>
        </div>
        <p class="text-gray-500 font-light text-lg">Tidak ada member ditemukan</p>
        <p class="text-gray-400 font-light text-sm mt-2">
            {% if search_query or member_filter %}
            Coba ubah filter pencarian Anda
            {% else %}
            Belum ada member yang terdaftar dengan perangkat
            {% endif %}
        </p>
    </div>
    {% endif %}
</div>
{% endblock %}

