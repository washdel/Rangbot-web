{% extends 'base.html' %}
{% load static %}

{% block title %}Pemesanan RangBot{% endblock %}

{% block content %}
<style>
    @keyframes fade-in {
        from {
            opacity: 0;
            transform: translateY(-10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    @keyframes slide-in {
        from {
            opacity: 0;
            transform: translateX(100%);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    .animate-fade-in {
        animation: fade-in 0.3s ease-out;
    }
    
    .animate-slide-in {
        animation: slide-in 0.4s ease-out;
    }
</style>

<div class="pt-24 sm:pt-28 pb-16 sm:pb-20 min-h-screen" style="background: linear-gradient(180deg, #ffffff 0%, #fafafa 100%);">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Messages -->
        {% if messages %}
        <div id="messages-container" class="mb-6 space-y-2">
            {% for message in messages %}
            <div class="p-4 rounded-xl border font-light text-sm animate-fade-in {% if message.tags == 'error' %}bg-red-50 border-red-200 text-red-800{% elif message.tags == 'warning' %}bg-yellow-50 border-yellow-200 text-yellow-800{% else %}bg-green-50 border-green-200 text-green-800{% endif %}" style="box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                <div class="flex items-start gap-3">
                    {% if message.tags == 'success' %}
                    <i class="fas fa-check-circle text-lg mt-0.5"></i>
                    {% elif message.tags == 'error' %}
                    <i class="fas fa-exclamation-circle text-lg mt-0.5"></i>
                    {% elif message.tags == 'warning' %}
                    <i class="fas fa-exclamation-triangle text-lg mt-0.5"></i>
                    {% endif %}
                    <div class="flex-1">
                        <p class="font-medium mb-1">{% if message.tags == 'success' %}Pesanan Berhasil Dikirim!{% elif message.tags == 'error' %}Terjadi Kesalahan{% elif message.tags == 'warning' %}Peringatan{% endif %}</p>
                        <p>{{ message }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        <script>
            // Auto scroll to messages if success
            {% if messages %}
                {% for message in messages %}
                    {% if message.tags == 'success' %}
                    setTimeout(function() {
                        document.getElementById('messages-container').scrollIntoView({ behavior: 'smooth', block: 'center' });
                    }, 100);
                    {% endif %}
                {% endfor %}
            {% endif %}
        </script>
        {% endif %}
        
        <!-- Toast Notification (for JavaScript) -->
        <div id="toast-notification" class="fixed top-20 right-4 z-50 hidden">
            <div class="bg-white rounded-2xl shadow-2xl border p-6 max-w-md animate-slide-in" style="border-color: rgba(134, 239, 172, 0.3); box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);">
                <div class="flex items-start gap-4">
                    <div class="w-12 h-12 rounded-full flex items-center justify-center flex-shrink-0" style="background: rgba(134, 239, 172, 0.1);">
                        <i class="fas fa-check-circle text-2xl" style="color: #86efac;"></i>
                    </div>
                    <div class="flex-1">
                        <h3 class="text-lg font-medium text-gray-900 mb-1">Pesanan Berhasil Dikirim!</h3>
                        <p class="text-sm font-light text-gray-600 mb-3">Terima kasih atas kepercayaan Anda. Tim kami akan menghubungi Anda dalam 1x24 jam untuk verifikasi.</p>
                        <button onclick="closeToast()" class="text-sm font-light text-gray-500 hover:text-gray-900 transition-colors">
                            Tutup
                        </button>
                    </div>
                    <button onclick="closeToast()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Header -->
        <div class="text-center mb-10 sm:mb-12">
            <h2 class="text-3xl sm:text-4xl lg:text-5xl text-gray-900 mb-3 sm:mb-4 tracking-tight font-light">Pemesanan RangBot</h2>
            <p class="text-base sm:text-lg text-gray-600 font-light max-w-2xl mx-auto">
                Pilih paket yang sesuai dengan kebutuhan greenhouse Anda
            </p>
        </div>

        <!-- Main Form Wrapper -->
        <form method="post" action="{% url 'main:purchase' %}" id="main-purchase-form">
            {% csrf_token %}
            <input type="hidden" name="payment_method" id="payment_method_input" value="">
        
        <div class="grid lg:grid-cols-3 gap-8">
            <!-- Left Column - Package Selection -->
            <div class="lg:col-span-2 space-y-8">
                <!-- Step 1: Choose Package -->
                <div id="choose-package" class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/60 p-6 sm:p-8 transition-all duration-300 hover:shadow-xl">
                    <div class="flex items-center gap-3 mb-8">
                        <div class="w-10 h-10 rounded-full text-white flex items-center justify-center font-light text-lg flex-shrink-0 shadow-md transition-all duration-300" 
                             style="background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);">
                            1
                        </div>
                        <h3 class="text-xl sm:text-2xl text-gray-900 tracking-tight font-light">Pilih Paket</h3>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-5 sm:gap-6 max-w-3xl mx-auto">
                        {% for plan in pricing_plans %}
                        <button onclick="selectPackage('{{ plan.name|lower }}')" 
                                class="group relative text-left p-5 sm:p-6 rounded-2xl border-2 transition-all duration-300 ease-out package-btn flex flex-col h-full {% if plan.highlight %}ring-2 ring-offset-2{% endif %}" 
                                data-package="{{ plan.name|lower }}"
                                style="border-color: {% if plan.name == 'Basic' %}rgba(239, 68, 68, 0.3){% elif plan.name == 'Professional' %}rgba(134, 239, 172, 0.4){% else %}rgba(239, 68, 68, 0.3){% endif %}; {% if plan.highlight %}ring-color: {% if plan.name == 'Basic' %}#ef4444{% elif plan.name == 'Professional' %}#86efac{% else %}#ef4444{% endif %}; ring-opacity: 0.2; box-shadow: 0 8px 24px {% if plan.name == 'Basic' %}rgba(239, 68, 68, 0.15){% elif plan.name == 'Professional' %}rgba(134, 239, 172, 0.25){% else %}rgba(239, 68, 68, 0.15){% endif %};{% else %}box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);{% endif %}"
                                onmouseenter="this.style.borderColor='{% if plan.name == 'Basic' %}rgba(239, 68, 68, 0.6){% elif plan.name == 'Professional' %}rgba(134, 239, 172, 0.7){% else %}rgba(239, 68, 68, 0.6){% endif %}'; this.style.transform='translateY(-4px)'; this.style.boxShadow='0 12px 32px {% if plan.name == 'Basic' %}rgba(239, 68, 68, 0.3){% elif plan.name == 'Professional' %}rgba(134, 239, 172, 0.4){% else %}rgba(239, 68, 68, 0.3){% endif %}';"
                                onmouseleave="this.style.borderColor='{% if plan.name == 'Basic' %}rgba(239, 68, 68, 0.3){% elif plan.name == 'Professional' %}rgba(134, 239, 172, 0.4){% else %}rgba(239, 68, 68, 0.3){% endif %}'; this.style.transform='translateY(0)'; this.style.boxShadow='{% if plan.highlight %}0 8px 24px {% if plan.name == 'Basic' %}rgba(239, 68, 68, 0.15){% elif plan.name == 'Professional' %}rgba(134, 239, 172, 0.25){% else %}rgba(239, 68, 68, 0.15){% endif %}{% else %}0 4px 12px rgba(0, 0, 0, 0.06){% endif %}';">
                            <!-- Animated Background Gradient -->
                            <div class="absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-[0.02] transition-opacity duration-300" 
                                 style="background: linear-gradient(135deg, {% if plan.name == 'Basic' %}#f87171{% elif plan.name == 'Professional' %}#86efac{% else %}#f87171{% endif %} 0%, {% if plan.name == 'Basic' %}#ef4444{% elif plan.name == 'Professional' %}#4ade80{% else %}#ef4444{% endif %} 100%); pointer-events: none;"></div>
                            
                            {% if plan.highlight %}
                            <div class="relative inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs font-medium mb-4 shadow-md animate-pulse w-fit" 
                                 style="background: linear-gradient(135deg, {% if plan.name == 'Basic' %}#f87171{% elif plan.name == 'Professional' %}#86efac{% else %}#f87171{% endif %} 0%, {% if plan.name == 'Basic' %}#ef4444{% elif plan.name == 'Professional' %}#4ade80{% else %}#ef4444{% endif %} 100%); color: white; box-shadow: 0 3px 10px {% if plan.name == 'Basic' %}rgba(239, 68, 68, 0.2){% elif plan.name == 'Professional' %}rgba(134, 239, 172, 0.2){% else %}rgba(239, 68, 68, 0.2){% endif %};">
                                <svg class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20">
                                    <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                </svg>
                                <span>Paling Populer</span>
                            </div>
                            {% endif %}
                            
                            <div class="relative flex-1 flex flex-col">
                                <h4 class="text-xl sm:text-2xl mb-2 font-light tracking-tight transition-colors duration-300" 
                                    style="color: {% if plan.name == 'Basic' %}#ef4444{% elif plan.name == 'Professional' %}#86efac{% else %}#ef4444{% endif %};">{{ plan.name }}</h4>
                                <p class="text-xs sm:text-sm text-gray-600 mb-4 font-light leading-relaxed">{{ plan.description|default:"Paket lengkap untuk kebutuhan Anda" }}</p>
                                
                                <!-- Price Box -->
                                <div class="mb-5 p-4 rounded-xl transition-all duration-300 overflow-hidden" 
                                     style="background: linear-gradient(135deg, {% if plan.name == 'Basic' %}rgba(239, 68, 68, 0.08){% elif plan.name == 'Professional' %}rgba(134, 239, 172, 0.08){% else %}rgba(239, 68, 68, 0.08){% endif %} 0%, {% if plan.name == 'Basic' %}rgba(239, 68, 68, 0.15){% elif plan.name == 'Professional' %}rgba(134, 239, 172, 0.15){% else %}rgba(239, 68, 68, 0.15){% endif %} 100%); border: 1px solid {% if plan.name == 'Basic' %}rgba(239, 68, 68, 0.25){% elif plan.name == 'Professional' %}rgba(134, 239, 172, 0.3){% else %}rgba(239, 68, 68, 0.25){% endif %};">
                                    {% if plan.price == "Custom" %}
                                    <div class="text-xl sm:text-2xl font-light tracking-tight mb-0.5 break-words" 
                                         style="color: {% if plan.name == 'Basic' %}#ef4444{% elif plan.name == 'Professional' %}#86efac{% else %}#ef4444{% endif %};">Custom</div>
                                    <p class="text-xs text-gray-600 mt-1 font-light">Diskusikan dengan tim kami</p>
                                    {% else %}
                                    <div class="flex items-baseline gap-1.5 flex-wrap">
                                        <span class="text-xs sm:text-sm text-gray-600 font-light flex-shrink-0">Rp</span>
                                        <span class="text-lg sm:text-xl font-light tracking-tight break-words" 
                                              style="color: {% if plan.name == 'Basic' %}#ef4444{% elif plan.name == 'Professional' %}#86efac{% else %}#ef4444{% endif %}; word-break: break-word; overflow-wrap: break-word;">{{ plan.price }}</span>
                                    </div>
                                    {% endif %}
                                </div>

                                <!-- Features List -->
                                <ul class="space-y-2.5 flex-1">
                                    {% for feature in plan.features %}
                                    <li class="flex items-start gap-2.5 text-xs sm:text-sm text-gray-700 font-light group/feature transition-all duration-200 hover:translate-x-0.5">
                                        <div class="flex-shrink-0 w-5 h-5 rounded-md flex items-center justify-center mt-0.5 transition-all duration-200 group-hover/feature:scale-105" 
                                             style="background: {% if plan.name == 'Basic' %}rgba(239, 68, 68, 0.1){% elif plan.name == 'Professional' %}rgba(134, 239, 172, 0.1){% else %}rgba(239, 68, 68, 0.1){% endif %}; border: 1px solid {% if plan.name == 'Basic' %}rgba(239, 68, 68, 0.25){% elif plan.name == 'Professional' %}rgba(134, 239, 172, 0.3){% else %}rgba(239, 68, 68, 0.25){% endif %};">
                                            <svg class="w-3.5 h-3.5 transition-colors duration-200" 
                                                 style="color: {% if plan.name == 'Basic' %}#ef4444{% elif plan.name == 'Professional' %}#86efac{% else %}#ef4444{% endif %};" 
                                                 fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                                <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                                            </svg>
                                        </div>
                                        <span class="leading-relaxed flex-1">{{ feature }}</span>
                                    </li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </button>
                        {% endfor %}
                    </div>

                    <!-- Jumlah Paket -->
                    <div class="mt-6 max-w-3xl mx-auto">
                        <h4 class="text-base sm:text-lg text-gray-900 mb-4 font-light tracking-tight">Jumlah Paket</h4>
                        <div class="grid md:grid-cols-2 gap-5 sm:gap-6">
                            <!-- Jumlah Paket Basic -->
                            <div class="space-y-2">
                                <label for="qty_basic" class="block text-sm font-light text-gray-700">
                                    Jumlah Paket Basic
                                </label>
                                <div class="relative group">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <svg class="w-5 h-5 text-gray-400 transition-colors duration-300 group-focus-within:text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                                        </svg>
                                    </div>
                                    <input type="number" id="qty_basic" name="qty_basic" min="0" value="0" 
                                           class="w-full pl-12 pr-4 py-3 rounded-xl border transition-all duration-300 font-light text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-offset-0"
                                           style="border-color: rgba(239, 68, 68, 0.3); background: rgba(255, 255, 255, 0.8);"
                                           onfocus="this.style.borderColor='rgba(239, 68, 68, 0.5)'; this.style.boxShadow='0 0 0 3px rgba(239, 68, 68, 0.1)';"
                                           onblur="this.style.borderColor='rgba(239, 68, 68, 0.3)'; this.style.boxShadow='none';"
                                           onchange="updateOrderSummary()">
                                </div>
                                <p class="text-xs text-gray-500 font-light">Masukkan jumlah paket Basic yang ingin dibeli</p>
                            </div>

                            <!-- Jumlah Paket Professional -->
                            <div class="space-y-2">
                                <label for="qty_professional" class="block text-sm font-light text-gray-700">
                                    Jumlah Paket Professional
                                </label>
                                <div class="relative group">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <svg class="w-5 h-5 text-gray-400 transition-colors duration-300 group-focus-within:text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" />
                                        </svg>
                                    </div>
                                    <input type="number" id="qty_professional" name="qty_professional" min="0" value="0" 
                                           class="w-full pl-12 pr-4 py-3 rounded-xl border transition-all duration-300 font-light text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-offset-0"
                                           style="border-color: rgba(134, 239, 172, 0.4); background: rgba(255, 255, 255, 0.8);"
                                           onfocus="this.style.borderColor='rgba(134, 239, 172, 0.6)'; this.style.boxShadow='0 0 0 3px rgba(134, 239, 172, 0.1)';"
                                           onblur="this.style.borderColor='rgba(134, 239, 172, 0.4)'; this.style.boxShadow='none';"
                                           onchange="updateOrderSummary()">
                                </div>
                                <p class="text-xs text-gray-500 font-light">Masukkan jumlah paket Professional yang ingin dibeli</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Contact Information -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/60 p-6 sm:p-8 transition-all duration-300 hover:shadow-xl">
                    <div class="flex items-center gap-3 mb-8">
                        <div class="w-10 h-10 rounded-full text-white flex items-center justify-center font-light text-lg flex-shrink-0 shadow-md transition-all duration-300" 
                             style="background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);">
                            2
                        </div>
                        <h3 class="text-xl sm:text-2xl text-gray-900 tracking-tight font-light">Informasi Kontak</h3>
                    </div>

                    <div class="space-y-5 sm:space-y-6" id="contact-form">
                        <div class="grid md:grid-cols-2 gap-5 sm:gap-6">
                            <div class="space-y-2">
                                <label for="name" class="block text-sm font-light text-gray-700">Nama Lengkap <span class="text-red-500">*</span></label>
                                <div class="relative group">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <svg class="w-5 h-5 text-gray-400 transition-colors duration-300 group-focus-within:text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                                        </svg>
                                    </div>
                                    <input type="text" id="name" name="name" placeholder="Masukkan nama lengkap" 
                                           class="w-full pl-12 pr-4 py-3 rounded-xl border transition-all duration-300 font-light text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-offset-0"
                                           style="border-color: rgba(229, 231, 235, 0.6); background: rgba(255, 255, 255, 0.8);"
                                           onfocus="this.style.borderColor='rgba(239, 68, 68, 0.5)'; this.style.boxShadow='0 0 0 3px rgba(239, 68, 68, 0.1)';"
                                           onblur="this.style.borderColor='rgba(229, 231, 235, 0.6)'; this.style.boxShadow='none';" required>
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label for="phone" class="block text-sm font-light text-gray-700">No. Telepon <span class="text-red-500">*</span></label>
                                <div class="relative group">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <svg class="w-5 h-5 text-gray-400 transition-colors duration-300 group-focus-within:text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                        </svg>
                                    </div>
                                    <input type="tel" id="phone" name="phone" placeholder="08xx-xxxx-xxxx" 
                                           class="w-full pl-12 pr-4 py-3 rounded-xl border transition-all duration-300 font-light text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-offset-0"
                                           style="border-color: rgba(229, 231, 235, 0.6); background: rgba(255, 255, 255, 0.8);"
                                           onfocus="this.style.borderColor='rgba(239, 68, 68, 0.5)'; this.style.boxShadow='0 0 0 3px rgba(239, 68, 68, 0.1)';"
                                           onblur="this.style.borderColor='rgba(229, 231, 235, 0.6)'; this.style.boxShadow='none';" required>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label for="email" class="block text-sm font-light text-gray-700">Email <span class="text-red-500">*</span></label>
                            <div class="relative group">
                                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                    <svg class="w-5 h-5 text-gray-400 transition-colors duration-300 group-focus-within:text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                    </svg>
                                </div>
                                <input type="email" id="email" name="email" placeholder="email@example.com" 
                                       class="w-full pl-12 pr-4 py-3 rounded-xl border transition-all duration-300 font-light text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-offset-0"
                                       style="border-color: rgba(229, 231, 235, 0.6); background: rgba(255, 255, 255, 0.8);"
                                       onfocus="this.style.borderColor='rgba(239, 68, 68, 0.5)'; this.style.boxShadow='0 0 0 3px rgba(239, 68, 68, 0.1)';"
                                       onblur="this.style.borderColor='rgba(229, 231, 235, 0.6)'; this.style.boxShadow='none';" required>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label for="company" class="block text-sm font-light text-gray-700">Nama Greenhouse / Perusahaan</label>
                            <div class="relative group">
                                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                    <svg class="w-5 h-5 text-gray-400 transition-colors duration-300 group-focus-within:text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" />
                                    </svg>
                                </div>
                                <input type="text" id="company" name="company" placeholder="Masukkan nama greenhouse" 
                                       class="w-full pl-12 pr-4 py-3 rounded-xl border transition-all duration-300 font-light text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-offset-0"
                                       style="border-color: rgba(229, 231, 235, 0.6); background: rgba(255, 255, 255, 0.8);"
                                       onfocus="this.style.borderColor='rgba(239, 68, 68, 0.5)'; this.style.boxShadow='0 0 0 3px rgba(239, 68, 68, 0.1)';"
                                       onblur="this.style.borderColor='rgba(229, 231, 235, 0.6)'; this.style.boxShadow='none';">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Greenhouse Details -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/60 p-6 sm:p-8 transition-all duration-300 hover:shadow-xl">
                    <div class="flex items-center gap-3 mb-8">
                        <div class="w-10 h-10 rounded-full text-white flex items-center justify-center font-light text-lg flex-shrink-0 shadow-md transition-all duration-300" 
                             style="background: linear-gradient(135deg, #86efac 0%, #4ade80 100%);">
                            3
                        </div>
                        <h3 class="text-xl sm:text-2xl text-gray-900 tracking-tight font-light">Detail Greenhouse</h3>
                    </div>

                    <div class="space-y-5 sm:space-y-6" id="greenhouse-form">
                        <div class="grid md:grid-cols-2 gap-5 sm:gap-6">
                            <div class="space-y-2">
                                <label for="blocks" class="block text-sm font-light text-gray-700">Jumlah Blok <span class="text-red-500">*</span></label>
                                <div class="relative group">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none z-10">
                                        <svg class="w-5 h-5 text-gray-400 transition-colors duration-300 group-focus-within:text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z" />
                                        </svg>
                                    </div>
                                    <select id="blocks" name="blocks" 
                                            class="w-full pl-12 pr-10 py-3 rounded-xl border transition-all duration-300 font-light text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-offset-0 appearance-none bg-white cursor-pointer"
                                            style="border-color: rgba(229, 231, 235, 0.6); background: rgba(255, 255, 255, 0.8);"
                                            onfocus="this.style.borderColor='rgba(134, 239, 172, 0.5)'; this.style.boxShadow='0 0 0 3px rgba(134, 239, 172, 0.1)';"
                                            onblur="this.style.borderColor='rgba(229, 231, 235, 0.6)'; this.style.boxShadow='none';" required>
                                        <option value="">Pilih jumlah blok</option>
                                        {% for i in "2345678910" %}
                                        <option value="{{ i }}">{{ i }} Blok</option>
                                        {% endfor %}
                                        <option value="custom">Lebih dari 10 Blok</option>
                                    </select>
                                    <div class="absolute inset-y-0 right-0 pr-4 flex items-center pointer-events-none">
                                        <svg class="w-5 h-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                                        </svg>
                                    </div>
                                </div>
                            </div>

                            <div class="space-y-2">
                                <label for="length" class="block text-sm font-light text-gray-700">Panjang per Blok (meter) <span class="text-red-500">*</span></label>
                                <div class="relative group">
                                    <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
                                        <svg class="w-5 h-5 text-gray-400 transition-colors duration-300 group-focus-within:text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14" />
                                        </svg>
                                    </div>
                                    <input type="number" id="length" name="length" placeholder="Contoh: 50" 
                                           class="w-full pl-12 pr-4 py-3 rounded-xl border transition-all duration-300 font-light text-sm sm:text-base focus:outline-none focus:ring-2 focus:ring-offset-0"
                                           style="border-color: rgba(229, 231, 235, 0.6); background: rgba(255, 255, 255, 0.8);"
                                           onfocus="this.style.borderColor='rgba(134, 239, 172, 0.5)'; this.style.boxShadow='0 0 0 3px rgba(134, 239, 172, 0.1)';"
                                           onblur="this.style.borderColor='rgba(229, 231, 235, 0.6)'; this.style.boxShadow='none';" required>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label for="address" class="block text-sm font-light text-gray-700">Alamat Instalasi <span class="text-red-500">*</span></label>
                            <div class="relative group">
                                <div class="absolute top-4 left-4 pointer-events-none">
                                    <svg class="w-5 h-5 text-gray-400 transition-colors duration-300 group-focus-within:text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
                                    </svg>
                                </div>
                                <textarea id="address" name="address" rows="4" placeholder="Alamat lengkap lokasi greenhouse" 
                                          class="w-full pl-12 pr-4 py-3 rounded-xl border transition-all duration-300 font-light text-sm sm:text-base resize-none focus:outline-none focus:ring-2 focus:ring-offset-0"
                                          style="border-color: rgba(229, 231, 235, 0.6); background: rgba(255, 255, 255, 0.8);"
                                          onfocus="this.style.borderColor='rgba(134, 239, 172, 0.5)'; this.style.boxShadow='0 0 0 3px rgba(134, 239, 172, 0.1)';"
                                          onblur="this.style.borderColor='rgba(229, 231, 235, 0.6)'; this.style.boxShadow='none';" required></textarea>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label for="notes" class="block text-sm font-light text-gray-700">Catatan Tambahan</label>
                            <div class="relative group">
                                <div class="absolute top-4 left-4 pointer-events-none">
                                    <svg class="w-5 h-5 text-gray-400 transition-colors duration-300 group-focus-within:text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                                    </svg>
                                </div>
                                <textarea id="notes" name="notes" rows="3" placeholder="Kebutuhan khusus atau pertanyaan (opsional)" 
                                          class="w-full pl-12 pr-4 py-3 rounded-xl border transition-all duration-300 font-light text-sm sm:text-base resize-none focus:outline-none focus:ring-2 focus:ring-offset-0"
                                          style="border-color: rgba(229, 231, 235, 0.6); background: rgba(255, 255, 255, 0.8);"
                                          onfocus="this.style.borderColor='rgba(134, 239, 172, 0.5)'; this.style.boxShadow='0 0 0 3px rgba(134, 239, 172, 0.1)';"
                                          onblur="this.style.borderColor='rgba(229, 231, 235, 0.6)'; this.style.boxShadow='none';"></textarea>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Payment Method -->
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/60 p-6 sm:p-8 transition-all duration-300 hover:shadow-xl">
                    <div class="flex items-center gap-3 mb-8">
                        <div class="w-10 h-10 rounded-full text-white flex items-center justify-center font-light text-lg flex-shrink-0 shadow-md transition-all duration-300" 
                             style="background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);">
                            4
                        </div>
                        <h3 class="text-xl sm:text-2xl text-gray-900 tracking-tight font-light">Metode Pembayaran</h3>
                    </div>

                    <div class="grid md:grid-cols-2 gap-4 sm:gap-5">
                        <button type="button" onclick="selectPayment('transfer')" 
                                class="group relative p-5 rounded-xl border-2 transition-all duration-300 text-left payment-btn overflow-hidden" 
                                data-payment="transfer"
                                style="border-color: rgba(229, 231, 235, 0.6); background: rgba(255, 255, 255, 0.8);"
                                onmouseenter="this.style.borderColor='rgba(239, 68, 68, 0.5)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(239, 68, 68, 0.15)';"
                                onmouseleave="this.style.borderColor='rgba(229, 231, 235, 0.6)'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                            <div class="absolute inset-0 bg-gradient-to-r from-red-50/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <div class="relative flex items-start gap-3">
                                <div class="w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0 transition-all duration-300 group-hover:scale-110" 
                                     style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.2) 100%);">
                                    <svg class="w-6 h-6" style="color: #ef4444;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="text-gray-900 mb-1 font-light text-base">Transfer Bank</h4>
                                    <p class="text-xs sm:text-sm text-gray-600 font-light">BCA, Mandiri, BNI</p>
                                </div>
                            </div>
                        </button>

                        <button type="button" onclick="selectPayment('credit')" 
                                class="group relative p-5 rounded-xl border-2 transition-all duration-300 text-left payment-btn overflow-hidden" 
                                data-payment="credit"
                                style="border-color: rgba(229, 231, 235, 0.6); background: rgba(255, 255, 255, 0.8);"
                                onmouseenter="this.style.borderColor='rgba(239, 68, 68, 0.5)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(239, 68, 68, 0.15)';"
                                onmouseleave="this.style.borderColor='rgba(229, 231, 235, 0.6)'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                            <div class="absolute inset-0 bg-gradient-to-r from-red-50/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <div class="relative flex items-start gap-3">
                                <div class="w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0 transition-all duration-300 group-hover:scale-110" 
                                     style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.2) 100%);">
                                    <svg class="w-6 h-6" style="color: #ef4444;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="text-gray-900 mb-1 font-light text-base">Kartu Kredit</h4>
                                    <p class="text-xs sm:text-sm text-gray-600 font-light">Visa, Mastercard</p>
                                </div>
                            </div>
                        </button>

                        <button type="button" onclick="selectPayment('installment')" 
                                class="group relative p-5 rounded-xl border-2 transition-all duration-300 text-left payment-btn overflow-hidden" 
                                data-payment="installment"
                                style="border-color: rgba(229, 231, 235, 0.6); background: rgba(255, 255, 255, 0.8);"
                                onmouseenter="this.style.borderColor='rgba(134, 239, 172, 0.5)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(134, 239, 172, 0.15)';"
                                onmouseleave="this.style.borderColor='rgba(229, 231, 235, 0.6)'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                            <div class="absolute inset-0 bg-gradient-to-r from-green-50/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <div class="relative flex items-start gap-3">
                                <div class="w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0 transition-all duration-300 group-hover:scale-110" 
                                     style="background: linear-gradient(135deg, rgba(134, 239, 172, 0.1) 0%, rgba(134, 239, 172, 0.2) 100%);">
                                    <svg class="w-6 h-6" style="color: #86efac;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="text-gray-900 mb-1 font-light text-base">Cicilan 0%</h4>
                                    <p class="text-xs sm:text-sm text-gray-600 font-light">Hingga 12 bulan</p>
                                </div>
                            </div>
                        </button>

                        <button type="button" onclick="selectPayment('leasing')" 
                                class="group relative p-5 rounded-xl border-2 transition-all duration-300 text-left payment-btn overflow-hidden" 
                                data-payment="leasing"
                                style="border-color: rgba(229, 231, 235, 0.6); background: rgba(255, 255, 255, 0.8);"
                                onmouseenter="this.style.borderColor='rgba(239, 68, 68, 0.5)'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(239, 68, 68, 0.15)';"
                                onmouseleave="this.style.borderColor='rgba(229, 231, 235, 0.6)'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
                            <div class="absolute inset-0 bg-gradient-to-r from-red-50/50 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <div class="relative flex items-start gap-3">
                                <div class="w-12 h-12 rounded-lg flex items-center justify-center flex-shrink-0 transition-all duration-300 group-hover:scale-110" 
                                     style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(239, 68, 68, 0.2) 100%);">
                                    <svg class="w-6 h-6" style="color: #ef4444;" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                                    </svg>
                                </div>
                                <div>
                                    <h4 class="text-gray-900 mb-1 font-light text-base">Leasing</h4>
                                    <p class="text-xs sm:text-sm text-gray-600 font-light">Flexible terms</p>
                                </div>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="button" id="submit-btn" onclick="submitOrder()" 
                        class="group relative w-full text-white rounded-xl shadow-lg h-14 text-base tracking-wide font-light transition-all duration-300 overflow-hidden hover:shadow-xl hover:scale-[1.02] active:scale-[0.98] disabled:opacity-50 disabled:cursor-not-allowed"
                        style="background: linear-gradient(135deg, #f87171 0%, #ef4444 100%); box-shadow: 0 6px 20px rgba(239, 68, 68, 0.3);"
                        onmouseenter="if(!this.disabled) { this.style.boxShadow='0 8px 25px rgba(239, 68, 68, 0.4)'; }"
                        onmouseleave="if(!this.disabled) { this.style.boxShadow='0 6px 20px rgba(239, 68, 68, 0.3)'; }">
                    <span id="submit-text" class="relative z-10 inline-flex items-center justify-center gap-2">
                        <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                        </svg>
                        Kirim Pesanan
                    </span>
                    <span id="submit-loading" class="relative z-10 inline-flex items-center justify-center gap-2 hidden">
                        <svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        Mengirim...
                    </span>
                    <div class="absolute inset-0 bg-gradient-to-r from-red-400 to-red-500 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                </button>

                <p class="text-xs sm:text-sm text-gray-500 text-center font-light mt-4">
                    Dengan melakukan pemesanan, Anda menyetujui <a href="#" class="text-red-500 hover:underline transition-colors duration-300">Syarat & Ketentuan</a> kami
                </p>
            </div>

            <!-- Right Column - Order Summary -->
            <div class="lg:col-span-1">
                <div class="bg-white/95 backdrop-blur-sm rounded-2xl shadow-lg border border-gray-200/60 p-6 sm:p-8 sticky top-24 transition-all duration-300 hover:shadow-xl">
                    <h3 class="text-xl sm:text-2xl text-gray-900 mb-6 tracking-tight font-light">Ringkasan Pesanan</h3>
                    
                    <div class="space-y-5 mb-6">
                        <div class="pb-4 border-b" style="border-color: rgba(229, 231, 235, 0.6);">
                            <div class="text-xs sm:text-sm text-gray-600 mb-2 font-light">Detail Paket</div>
                            <div class="text-base sm:text-lg text-gray-900 font-light" id="package-details" style="color: #6b7280;">Belum ada paket dipilih</div>
                        </div>

                        <div class="pb-4 border-b" style="border-color: rgba(229, 231, 235, 0.6);">
                            <div class="text-xs sm:text-sm text-gray-600 mb-2 font-light">Total Harga</div>
                            <div class="text-xl sm:text-2xl text-gray-900 font-light" id="total-price" style="color: #6b7280;">Rp 0</div>
                        </div>

                        <div class="pb-4 border-b" style="border-color: rgba(229, 231, 235, 0.6);">
                            <div class="text-xs sm:text-sm text-gray-600 mb-2 font-light">Metode Pembayaran</div>
                            <div class="text-base sm:text-lg text-gray-900 font-light" id="selected-payment" style="color: #6b7280;">Belum dipilih</div>
                        </div>
                    </div>

                    <div class="rounded-xl p-4 mb-6 transition-all duration-300" 
                         style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.05) 0%, rgba(239, 68, 68, 0.1) 100%); border: 1px solid rgba(239, 68, 68, 0.2);">
                        <div class="flex items-start gap-3">
                            <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" 
                                 style="background: linear-gradient(135deg, #f87171 0%, #ef4444 100%);">
                                <svg class="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <div class="text-xs sm:text-sm" style="color: #374151;">
                                <p class="font-light mb-2">Proses Selanjutnya:</p>
                                <ul class="space-y-1.5 text-xs font-light">
                                    <li class="flex items-center gap-2">
                                        <span style="color: #ef4444;"></span>
                                        <span>Konfirmasi dalam 1x24 jam</span>
                                    </li>
                                    <li class="flex items-center gap-2">
                                        <span style="color: #ef4444;"></span>
                                        <span>Survey lokasi (jika perlu)</span>
                                    </li>
                                    <li class="flex items-center gap-2">
                                        <span style="color: #ef4444;"></span>
                                        <span>Jadwal instalasi</span>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="text-xs sm:text-sm space-y-3" style="color: #6b7280;">
                        <p class="font-light">Butuh bantuan?</p>
                        <div class="flex flex-col gap-2.5">
                            <a href="tel:+6281234567890" class="group flex items-center gap-2.5 font-light transition-colors duration-300 hover:opacity-80" style="color: #ef4444;">
                                <svg class="w-4 h-4 transition-transform duration-300 group-hover:scale-110" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z" />
                                </svg>
                                <span>+62 812-3456-7890</span>
                            </a>
                            <a href="mailto:sales@rangbot.com" class="group flex items-center gap-2.5 font-light transition-colors duration-300 hover:opacity-80" style="color: #ef4444;">
                                <svg class="w-4 h-4 transition-transform duration-300 group-hover:scale-110" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                </svg>
                                <span>sales@rangbot.com</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Handle Enter key on form fields
    document.addEventListener('DOMContentLoaded', function() {
        const formFields = document.querySelectorAll('#main-purchase-form input, #main-purchase-form textarea, #main-purchase-form select');
        formFields.forEach(field => {
            field.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    // Check if we're near the submit button
                    const submitBtn = document.getElementById('submit-btn');
                    if (submitBtn && !submitBtn.disabled) {
                        const submitBtnRect = submitBtn.getBoundingClientRect();
                        const fieldRect = field.getBoundingClientRect();
                        // If field is near submit button (within 200px), submit
                        if (Math.abs(fieldRect.bottom - submitBtnRect.top) < 200) {
                            submitOrder();
                        } else {
                            // Focus next field
                            const currentIndex = Array.from(formFields).indexOf(field);
                            if (currentIndex < formFields.length - 1) {
                                formFields[currentIndex + 1].focus();
                            }
                        }
                    } else {
                        // Focus next field
                        const currentIndex = Array.from(formFields).indexOf(field);
                        if (currentIndex < formFields.length - 1) {
                            formFields[currentIndex + 1].focus();
                        }
                    }
                }
            });
        });
    });
</script>
<script>
    let selectedPackage = '';
    let selectedPayment = '';

    const packages = {
        {% for plan in pricing_plans %}
        '{{ plan.name|lower }}': {
            name: '{{ plan.name }}',
            price: '{{ plan.price }}'
        },
        {% endfor %}
    };

    const paymentMethods = {
        'transfer': 'Transfer Bank',
        'credit': 'Kartu Kredit',
        'installment': 'Cicilan 0%',
        'leasing': 'Leasing'
    };

    function selectPackage(pkgName) {
        selectedPackage = pkgName;
        
        // Update UI with proper colors
        document.querySelectorAll('.package-btn').forEach(btn => {
            const planName = btn.dataset.package;
            const isHighlight = btn.classList.contains('ring-2');
            let borderColor, shadowColor;
            if (planName === 'basic') {
                borderColor = 'rgba(239, 68, 68, 0.3)';
                shadowColor = isHighlight ? '0 8px 24px rgba(239, 68, 68, 0.15)' : '0 4px 12px rgba(0, 0, 0, 0.06)';
            } else if (planName === 'professional') {
                borderColor = 'rgba(134, 239, 172, 0.4)';
                shadowColor = isHighlight ? '0 8px 24px rgba(134, 239, 172, 0.25)' : '0 4px 12px rgba(0, 0, 0, 0.06)';
            } else {
                borderColor = 'rgba(239, 68, 68, 0.3)';
                shadowColor = '0 4px 12px rgba(0, 0, 0, 0.06)';
            }
            btn.style.borderColor = borderColor;
            btn.style.boxShadow = shadowColor;
            btn.style.transform = 'translateY(0)';
        });
        
        const selectedBtn = document.querySelector(`[data-package="${pkgName}"]`);
        if (selectedBtn) {
            const planName = selectedBtn.dataset.package;
            let borderColor, shadowColor;
            if (planName === 'basic') {
                borderColor = 'rgba(239, 68, 68, 0.6)';
                shadowColor = '0 12px 32px rgba(239, 68, 68, 0.3)';
            } else if (planName === 'professional') {
                borderColor = 'rgba(134, 239, 172, 0.7)';
                shadowColor = '0 12px 32px rgba(134, 239, 172, 0.4)';
            } else {
                borderColor = 'rgba(239, 68, 68, 0.6)';
                shadowColor = '0 12px 32px rgba(239, 68, 68, 0.3)';
            }
            selectedBtn.style.borderColor = borderColor;
            selectedBtn.style.boxShadow = shadowColor;
            selectedBtn.style.transform = 'translateY(-2px)';
        }
        
        // Update summary
        updateOrderSummary();
    }

    function updateOrderSummary() {
        // Get quantities
        const qtyBasic = parseInt(document.getElementById('qty_basic').value) || 0;
        const qtyProfessional = parseInt(document.getElementById('qty_professional').value) || 0;
        
        // Get prices (remove dots and convert to number)
        const priceBasic = parseInt(packages.basic.price.replace(/\./g, '')) || 0;
        const priceProfessional = parseInt(packages.professional.price.replace(/\./g, '')) || 0;
        
        // Calculate totals
        const totalBasic = qtyBasic * priceBasic;
        const totalProfessional = qtyProfessional * priceProfessional;
        const grandTotal = totalBasic + totalProfessional;
        
        // Format number with dots
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, '.');
        }
        
        // Update package details
        const packageDetailsEl = document.getElementById('package-details');
        let details = [];
        
        if (qtyBasic > 0) {
            details.push(`${qtyBasic}x Paket Basic`);
        }
        if (qtyProfessional > 0) {
            details.push(`${qtyProfessional}x Paket Professional`);
        }
        
        if (details.length > 0) {
            packageDetailsEl.innerHTML = details.join('<br>');
            packageDetailsEl.style.color = '#1f2937';
        } else {
            packageDetailsEl.textContent = 'Belum ada paket dipilih';
            packageDetailsEl.style.color = '#6b7280';
        }
        
        // Update total price
        const totalPriceEl = document.getElementById('total-price');
        if (grandTotal > 0) {
            totalPriceEl.textContent = 'Rp ' + formatNumber(grandTotal);
            totalPriceEl.style.color = '#1f2937';
        } else {
            totalPriceEl.textContent = 'Rp 0';
            totalPriceEl.style.color = '#6b7280';
        }
    }

    // Auto-select package from URL parameter and scroll to choose-package section
    // Initialize order summary on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize order summary
        updateOrderSummary();
        
        const urlParams = new URLSearchParams(window.location.search);
        const packageParam = urlParams.get('paket');
        
        if (packageParam) {
            // Select package immediately
            selectPackage(packageParam.toLowerCase());
            
            // Scroll to choose-package section
            setTimeout(() => {
                const choosePackageSection = document.getElementById('choose-package');
                if (choosePackageSection) {
                    const headerOffset = 100;
                    const elementPosition = choosePackageSection.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                    
                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });
                }
            }, 300);
        }
        
        // Also handle hash anchor if present
        if (window.location.hash === '#choose-package') {
            setTimeout(() => {
                const choosePackageSection = document.getElementById('choose-package');
                if (choosePackageSection) {
                    const headerOffset = 100;
                    const elementPosition = choosePackageSection.getBoundingClientRect().top;
                    const offsetPosition = elementPosition + window.pageYOffset - headerOffset;
                    
                    window.scrollTo({
                        top: offsetPosition,
                        behavior: 'smooth'
                    });
                }
            }, 300);
        }
    });

    function selectPayment(method) {
        selectedPayment = method;
        
        // Update hidden input
        const paymentInput = document.getElementById('payment_method_input');
        if (paymentInput) {
            paymentInput.value = method;
        }
        
        // Update UI with proper styling
        document.querySelectorAll('.payment-btn').forEach(btn => {
            btn.style.borderColor = 'rgba(229, 231, 235, 0.6)';
            btn.style.background = 'rgba(255, 255, 255, 0.8)';
            btn.style.transform = 'translateY(0)';
            btn.style.boxShadow = 'none';
        });
        
        const selectedBtn = document.querySelector(`[data-payment="${method}"]`);
        if (selectedBtn) {
            // Use green for installment, red for others
            if (method === 'installment') {
                selectedBtn.style.borderColor = 'rgba(134, 239, 172, 0.6)';
                selectedBtn.style.background = 'rgba(134, 239, 172, 0.05)';
                selectedBtn.style.boxShadow = '0 8px 20px rgba(134, 239, 172, 0.2)';
            } else {
                selectedBtn.style.borderColor = 'rgba(239, 68, 68, 0.6)';
                selectedBtn.style.background = 'rgba(239, 68, 68, 0.05)';
                selectedBtn.style.boxShadow = '0 8px 20px rgba(239, 68, 68, 0.2)';
            }
            selectedBtn.style.transform = 'translateY(-2px)';
        }
        
        // Update summary
        if (paymentMethods[method]) {
            const paymentEl = document.getElementById('selected-payment');
            paymentEl.textContent = paymentMethods[method];
            paymentEl.style.color = '#1f2937';
        }
    }

    function submitOrder() {
        // Check if at least one package quantity is greater than 0
        const qtyBasic = parseInt(document.getElementById('qty_basic').value) || 0;
        const qtyProfessional = parseInt(document.getElementById('qty_professional').value) || 0;
        
        if (qtyBasic === 0 && qtyProfessional === 0) {
            showAlert('Silakan pilih minimal 1 paket (Basic atau Professional)', 'warning');
            return;
        }
        
        if (!selectedPayment) {
            showAlert('Silakan pilih metode pembayaran terlebih dahulu', 'warning');
            return;
        }
        
        // Validate required fields manually
        const requiredFields = {
            'name': 'Nama Lengkap',
            'email': 'Email',
            'phone': 'Nomor Telepon',
            'address': 'Alamat',
            'blocks': 'Jumlah Blok',
            'length': 'Panjang Rel'
        };
        
        let hasError = false;
        let firstErrorField = null;
        
        for (const [fieldId, fieldName] of Object.entries(requiredFields)) {
            const field = document.getElementById(fieldId);
            if (field) {
                const value = field.value.trim();
                if (!value) {
                    hasError = true;
                    if (!firstErrorField) {
                        firstErrorField = field;
                    }
                    // Highlight error field
                    field.style.borderColor = 'rgba(239, 68, 68, 0.6)';
                    field.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.1)';
                    
                    // Remove error highlight on input
                    field.addEventListener('input', function() {
                        this.style.borderColor = 'rgba(229, 231, 235, 0.6)';
                        this.style.boxShadow = 'none';
                    }, { once: true });
                }
            }
        }
        
        // Validate email format
        const emailField = document.getElementById('email');
        if (emailField && emailField.value.trim()) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(emailField.value.trim())) {
                hasError = true;
                if (!firstErrorField) {
                    firstErrorField = emailField;
                }
                emailField.style.borderColor = 'rgba(239, 68, 68, 0.6)';
                emailField.style.boxShadow = '0 0 0 3px rgba(239, 68, 68, 0.1)';
                showAlert('Format email tidak valid', 'warning');
                return;
            }
        }
        
        if (hasError) {
            showAlert('Silakan lengkapi semua field yang wajib diisi', 'warning');
            if (firstErrorField) {
                setTimeout(() => {
                    firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    firstErrorField.focus();
                }, 300);
            }
            return;
        }
        
        // Show loading state
        const submitBtn = document.getElementById('submit-btn');
        const submitText = document.getElementById('submit-text');
        const submitLoading = document.getElementById('submit-loading');
        
        submitBtn.disabled = true;
        submitText.classList.add('hidden');
        submitLoading.classList.remove('hidden');
        
        // Submit main form
        const mainForm = document.getElementById('main-purchase-form');
        if (mainForm) {
            // Scroll to top to see notification
            window.scrollTo({ top: 0, behavior: 'smooth' });
            mainForm.submit();
        } else {
            submitBtn.disabled = false;
            submitText.classList.remove('hidden');
            submitLoading.classList.add('hidden');
            showAlert('Terjadi kesalahan. Silakan refresh halaman dan coba lagi.', 'error');
        }
    }
    
    function showAlert(message, type) {
        // Create alert element
        const alertDiv = document.createElement('div');
        alertDiv.className = `p-4 rounded-xl border font-light text-sm mb-4 animate-fade-in ${
            type === 'error' ? 'bg-red-50 border-red-200 text-red-800' : 
            type === 'warning' ? 'bg-yellow-50 border-yellow-200 text-yellow-800' : 
            'bg-green-50 border-green-200 text-green-800'
        }`;
        alertDiv.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';
        
        const icon = type === 'error' ? 'fa-exclamation-circle' : 
                    type === 'warning' ? 'fa-exclamation-triangle' : 
                    'fa-check-circle';
        
        alertDiv.innerHTML = `
            <div class="flex items-start gap-3">
                <i class="fas ${icon} text-lg mt-0.5"></i>
                <div class="flex-1">
                    <p>${message}</p>
                </div>
                <button onclick="this.parentElement.parentElement.remove()" class="text-gray-400 hover:text-gray-600 transition-colors">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        `;
        
        // Insert at the top of messages container or create one
        let messagesContainer = document.getElementById('messages-container');
        if (!messagesContainer) {
            messagesContainer = document.createElement('div');
            messagesContainer.id = 'messages-container';
            messagesContainer.className = 'mb-6 space-y-2';
            const header = document.querySelector('.text-center.mb-10');
            if (header) {
                header.parentNode.insertBefore(messagesContainer, header);
            }
        }
        
        messagesContainer.insertBefore(alertDiv, messagesContainer.firstChild);
        
        // Auto remove after 5 seconds
        setTimeout(() => {
            if (alertDiv.parentNode) {
                alertDiv.style.opacity = '0';
                alertDiv.style.transition = 'opacity 0.3s';
                setTimeout(() => alertDiv.remove(), 300);
            }
        }, 5000);
        
        // Scroll to alert
        setTimeout(() => {
            alertDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }, 100);
    }
    
    function closeToast() {
        const toast = document.getElementById('toast-notification');
        if (toast) {
            toast.classList.add('hidden');
        }
    }
    
    // Check for success message on page load
    document.addEventListener('DOMContentLoaded', function() {
        {% if messages %}
            {% for message in messages %}
                {% if message.tags == 'success' %}
                // Show toast notification
                setTimeout(function() {
                    const toast = document.getElementById('toast-notification');
                    if (toast) {
                        toast.classList.remove('hidden');
                        // Auto close after 10 seconds
                        setTimeout(closeToast, 10000);
                    }
                }, 500);
                {% endif %}
            {% endfor %}
        {% endif %}
    });
</script>
{% endblock %}

