{% extends 'base.html' %}
{% load static %}

{% block title %}{{ post.title }} - Forum RangBot{% endblock %}

{% block content %}
<div class="pt-28 pb-20 min-h-screen bg-gradient-to-b from-white via-gray-50/30 to-white relative overflow-hidden">
    <div class="absolute inset-0 opacity-[0.015]" style="background-image: radial-gradient(circle at 2px 2px, rgba(0,0,0,0.15) 1px, transparent 0); background-size: 40px 40px;"></div>
    
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
        <!-- Back Button -->
        <a href="{% url 'main:forum_list' %}" class="inline-flex items-center gap-2 mb-6 text-gray-600 transition-colors font-light" 
           onmouseover="this.style.color='{% if post.category == 'penyakit' or post.category == 'teknis' %}#ef4444{% else %}#86efac{% endif %}';"
           onmouseout="this.style.color='#6b7280';">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
            </svg>
            Kembali ke Forum
        </a>

        <!-- Messages -->
        {% if messages %}
        <div class="mb-6 space-y-2">
            {% for message in messages %}
            <div class="px-4 py-3 rounded-xl bg-white/80 backdrop-blur-sm border" 
                 style="border-color: {% if message.tags == 'success' %}rgba(134, 239, 172, 0.4){% elif message.tags == 'error' %}rgba(239, 68, 68, 0.4){% else %}rgba(229, 231, 235, 0.6){% endif %};">
                <p class="text-sm font-light" style="color: {% if message.tags == 'success' %}#86efac{% elif message.tags == 'error' %}#ef4444{% else %}#6b7280{% endif %};">
                    {{ message }}
                </p>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Post Content -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200/60 p-6 sm:p-8 mb-6" style="border-color: rgba(229, 231, 235, 0.6);">
            <!-- Post Header -->
            <div class="flex items-start justify-between gap-4 mb-6">
                <div class="flex-1">
                    <div class="flex items-center gap-3 mb-3">
                        <span class="px-3 py-1.5 rounded-full text-xs font-medium" 
                              style="{% if post.category == 'penyakit' or post.category == 'teknis' %}background: rgba(239, 68, 68, 0.1); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3);{% else %}background: rgba(134, 239, 172, 0.1); color: #86efac; border: 1px solid rgba(134, 239, 172, 0.3);{% endif %}">
                            {{ post.get_category_display }}
                        </span>
                    </div>
                    <h1 class="text-2xl sm:text-3xl text-gray-900 font-light tracking-tight mb-4">
                        {{ post.title }}
                    </h1>
                    <div class="flex items-center gap-4 text-sm text-gray-600 font-light">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center" style="{% if post.category == 'penyakit' or post.category == 'teknis' %}background: rgba(239, 68, 68, 0.2);{% else %}background: rgba(134, 239, 172, 0.2);{% endif %}">
                                <span class="text-sm font-medium" style="color: {% if post.category == 'penyakit' or post.category == 'teknis' %}#ef4444{% else %}#86efac{% endif %};">{{ post.author.get_display_name|first|upper }}</span>
                            </div>
                            <div>
                                <p class="font-medium text-gray-900">{{ post.author.get_display_name }}</p>
                                <p class="text-xs text-gray-500">{{ post.author.get_role_display }} • {{ post.author.email }}</p>
                            </div>
                        </div>
                        <span>•</span>
                        <span>{{ post.created_at|date:"d M Y, H:i" }}</span>
                        <span>•</span>
                        <span>{{ post.views }} dilihat</span>
                    </div>
                </div>
                {% if forum_user == post.author %}
                <div class="flex gap-2">
                    <a href="{% url 'main:forum_edit' post.id %}" class="px-4 py-2 rounded-xl text-sm font-light transition-all duration-300 hover:bg-gray-100" style="color: #6b7280;">
                        Edit
                    </a>
                    <a href="{% url 'main:forum_delete' post.id %}" class="px-4 py-2 rounded-xl text-sm font-light transition-all duration-300 hover:bg-red-50" style="color: #ef4444;">
                        Hapus
                    </a>
                </div>
                {% endif %}
            </div>

            <!-- Post Body -->
            <div class="prose prose-sm sm:prose-base max-w-none mb-6">
                <p class="text-gray-700 font-light leading-relaxed whitespace-pre-wrap">{{ post.content }}</p>
            </div>
        </div>

        <!-- Comments Section -->
        <div class="bg-white/80 backdrop-blur-sm rounded-2xl border border-gray-200/60 p-6 sm:p-8" style="border-color: rgba(229, 231, 235, 0.6);">
            <h2 class="text-xl sm:text-2xl text-gray-900 font-light tracking-tight mb-6">
                Komentar ({{ comments.count }})
            </h2>

            <!-- Comment Form (only for logged in users) -->
            {% if forum_user %}
                {% if comment_form %}
                <form method="post" class="mb-8">
                    {% csrf_token %}
                    <input type="hidden" name="comment" value="1">
                    <div class="mb-4">
                        {{ comment_form.content }}
                    </div>
                    <button type="submit" class="px-6 py-3 rounded-xl text-white font-light text-sm sm:text-base transition-all duration-300 hover:scale-105" 
                            style="background: linear-gradient(135deg, {% if post.category == 'penyakit' or post.category == 'teknis' %}#f87171 0%, #ef4444 100%{% else %}#86efac 0%, #4ade80 100%{% endif %}); box-shadow: 0 4px 12px {% if post.category == 'penyakit' or post.category == 'teknis' %}rgba(239, 68, 68, 0.3){% else %}rgba(134, 239, 172, 0.3){% endif %};">
                        Kirim Komentar
                    </button>
                </form>
                {% endif %}
            {% else %}
                <div class="mb-8 p-4 rounded-xl bg-gray-50 border border-gray-200/60 text-center">
                    <p class="text-sm text-gray-600 font-light mb-3">Anda harus login untuk menambahkan komentar</p>
                    <div class="flex flex-col sm:flex-row gap-3 justify-center">
                        <a href="{% url 'main:forum_login' %}?next={% url 'main:forum_detail' post.id %}" class="inline-block px-6 py-2 rounded-xl text-white font-light text-sm transition-all duration-300 hover:scale-105" 
                           style="background: linear-gradient(135deg, {% if post.category == 'penyakit' or post.category == 'teknis' %}#f87171 0%, #ef4444 100%{% else %}#86efac 0%, #4ade80 100%{% endif %}); box-shadow: 0 4px 12px {% if post.category == 'penyakit' or post.category == 'teknis' %}rgba(239, 68, 68, 0.3){% else %}rgba(134, 239, 172, 0.3){% endif %};">
                            Login Forum
                        </a>
                        <a href="{% url 'main:forum_register' %}?next={% url 'main:forum_detail' post.id %}" class="inline-block px-6 py-2 rounded-xl text-gray-700 font-light text-sm transition-all duration-300 hover:bg-gray-100 border" 
                           style="border-color: rgba(229, 231, 235, 0.6);">
                            Daftar Akun
                        </a>
                    </div>
                </div>
            {% endif %}

            <!-- Comments List -->
            <div class="space-y-6">
                {% if comments %}
                    {% for comment in comments %}
                    <div class="border-b border-gray-200/60 pb-6 last:border-b-0 last:pb-0 {% if comment.is_cs_note %}bg-green-50/50 rounded-lg p-4 border-l-4 border-green-500{% elif comment.replied_by_cs %}bg-blue-50/50 rounded-lg p-4 border-l-4 border-blue-400{% endif %}">
                        <div class="flex items-start gap-3 mb-3">
                            <div class="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0" 
                                 style="{% if comment.is_cs_note %}background: rgba(34, 197, 94, 0.2);{% elif comment.replied_by_cs %}background: rgba(59, 130, 246, 0.2);{% elif post.category == 'penyakit' or post.category == 'teknis' %}background: rgba(239, 68, 68, 0.2);{% else %}background: rgba(134, 239, 172, 0.2);{% endif %}">
                                {% if comment.replied_by_cs %}
                                    <span class="text-sm font-medium" style="color: {% if comment.is_cs_note %}#22c55e{% else %}#3b82f6{% endif %};">CS</span>
                                {% else %}
                                    <span class="text-sm font-medium" style="color: {% if post.category == 'penyakit' or post.category == 'teknis' %}#ef4444{% else %}#86efac{% endif %};">{{ comment.author.get_display_name|first|upper }}</span>
                                {% endif %}
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1 flex-wrap">
                                    {% if comment.is_cs_note %}
                                        <span class="px-2 py-0.5 rounded text-xs font-medium bg-green-600 text-white">
                                            <i class="fas fa-check-circle mr-1"></i>Catatan CS
                                        </span>
                                        {% if comment.replied_by_cs %}
                                            <p class="font-medium text-gray-900 text-sm">{{ comment.replied_by_cs.full_name }}</p>
                                        {% else %}
                                            <p class="font-medium text-gray-900 text-sm">Customer Service</p>
                                        {% endif %}
                                    {% elif comment.replied_by_cs %}
                                        <span class="px-2 py-0.5 rounded text-xs font-medium bg-blue-600 text-white">
                                            <i class="fas fa-user-tie mr-1"></i>Customer Service
                                        </span>
                                        {% if comment.replied_by_cs %}
                                            <p class="font-medium text-gray-900 text-sm">{{ comment.replied_by_cs.full_name }}</p>
                                        {% else %}
                                            <p class="font-medium text-gray-900 text-sm">CS</p>
                                        {% endif %}
                                    {% else %}
                                        <p class="font-medium text-gray-900 text-sm">{{ comment.author.get_display_name }}</p>
                                    <span class="text-xs text-gray-500">{{ comment.author.get_role_display }}</span>
                                    {% endif %}
                                    <span class="text-xs text-gray-400">•</span>
                                    <span class="text-xs text-gray-500">{{ comment.created_at|date:"d M Y, H:i" }}</span>
                                </div>
                                <p class="text-gray-700 font-light leading-relaxed whitespace-pre-wrap">{{ comment.content }}</p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="text-center py-8 text-gray-500 font-light">
                        <p>Belum ada komentar. Jadilah yang pertama berkomentar!</p>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

